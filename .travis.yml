env:
  - GO111MODULE=on

language: go
go:
  - 1.12.x
  - master
before_install:
  - go get github.com/mattn/goveralls
git:
  depth: 1
script:
  - go test -v -race ./... -coverprofile=profile.cov
  - $GOPATH/bin/goveralls -coverprofile=profile.cov -service=travis-ci
stages:
  - 'Lint'
  - 'Integration tests'
  - 'Test'
jobs:
  include:
    - stage: 'Lint'
      install:
        - curl -sfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh| sh -s -- -b $(go env GOPATH)/bin v1.19.0
      script:
        - $GOPATH/bin/golangci-lint run --out-format=tab --tests=false optimizely/...
    - stage: 'Integration tests'
      install:
        - scripts/get-fsc-tests.sh
        - go get
      script:
        - go test -count=1
      after_success: travis_terminate 0
      
