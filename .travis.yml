env:
  - GO111MODULE=on

language: go
go:
  - 1.12.x
  - 1.8.x
  - master
before_install:
  - go get golang.org/x/tools/cmd/cover
  - go get github.com/modocache/gover
  - go get github.com/mattn/goveralls
git:
  depth: 1
script:
  - go test -v -race ./...
  - $GOPATH/bin/gover
  - $GOPATH/bin/goveralls -coverprofile=gover.coverprofile -service=travis-ci
stages:
  - 'Lint'
  - 'Integration tests'
  - 'Test'
jobs:
  include:
    - stage: 'Lint'
      install:
        - go get github.com/golangci/golangci-lint/cmd/golangci-lint
      script:
        - golangci-lint run --out-format=tab --tests=false optimizely/...
    - stage: 'Integration Tests'
      merge_mode: replace
      env: SDK=go
      cache: false
      language: minimal
      install: skip
      before_script:
        - mkdir $HOME/travisci-tools && pushd $HOME/travisci-tools && git init && git pull https://$CI_USER_TOKEN@github.com/optimizely/travisci-tools.git && popd
      script:
        - "$HOME/travisci-tools/fsc-trigger/trigger_fullstack-sdk-compat.sh"
      after_success: travis_terminate 0

